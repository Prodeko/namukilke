{% extends 'namu/base.html' %}

{% block body %}

  <div class="row section">
    <div class="col s6 offset-s3">
      <h3>Namukilke</h3>
      <div class="divider"></div>
      <h5>{{ user.name }}</h5>
      <h6>Account balance: {{ user.account_balance }} €</h6>
    </div>
  </div>
  <div class="row">
    <div class="col s6 right-align">
      <a class="waves-effect waves-light btn" href={% url "index" %}>Change account</a>
    </div>
    <div class="col s6 left-align">
      <a class="waves-effect waves-light btn" href={% url "buy" user.id %}>Purchase snacks</a></a>
    </div>
  </div>
  <div class="divider"></div>

  <div class="row section">
    <div class="col s12">
      <h5>Add funds to your account</h5>
    </div>
  </div>

  <div class="row">
    <form id="deposit-form" class="col s2 offset-s5 left-align" action={% url "topup" user.id %} method="post">
      <div class="row">
        {% csrf_token %}
        <div class="input-field col s12">
          <p>
            <label>
              <input class="with-gap" name="payment_method" type="radio" value="c" checked />
              <span>Cash</span>
            </label>
          </p>
          <p>
            <label>
              <input class="with-gap" name="payment_method" type="radio" value="m" />
              <span>MobilePay</span>
            </label>
          </p>
        </div>
      </div>
      <div class="row">
        <div class="input-field col s6">
          <label for="amount">Amount: </label>
          <input name="amount" id="amount" type="number" placeholder="0.00">
        </div>
        <div class="input-field col s6">
          <button class="btn waves-effect waves-light" type="submit">Continue</button>
        </div>
      </div>
    </form>
  </div>
  <div class="divider"></div>

  <div id="deposit-modal" class="modal">
    <div class="modal-content">
      <h4>Make a deposit</h4>
      <p>
        Payment method: <span id="modal-pmethod"></span>
        <br>
        Amount: <span id="modal-amount"></span> €
      </p>
      <p id="mobilepay"></p>
      <p id="deposit-modal-text"></p>
      <br>
      <div class="row center-align">
        <div class="col s6 right-align">
          <button class="btn waves-effect waves-light modal-close red darken-2">Cancel</button>
        </div>
        <div class="col s6 left-align">
          <button class="btn waves-effect waves-light modal-close" onclick="postDepositForm()">Done</button>
        </div>
      </div>
    </div>
  </div>
  <!--- Display modal to confirm deposit and give instructions for actual payment. -->
  <script>
    $( "#deposit-form" ).submit(function( event ) {
      event.preventDefault();
      var paymentMethod = $("input[name=payment_method]:checked").val();
      var amount = $("#amount").val();
      showModal(paymentMethod, amount);
    });

    function showModal(paymentMethod, amount) {
      if (paymentMethod === "c") {
        $("#modal-pmethod").html("Cash");
        $("#deposit-modal-text").html("Put cash in the grey box.")
      } else if (paymentMethod === "m") {
        $("#modal-pmethod").html("MobilePay");
        var mp = "{{ namuseta.mobilepay }}"
        $("#mobilepay").html(mp)
        $("#deposit-modal-text").html("Send money with MobilePay to the above number. <br> No message needed in MobilePay.")
      }
      $("#modal-amount").html(amount);
      $('#deposit-modal').modal();
      $('#deposit-modal').modal('open');
    };

    function postDepositForm() {
      $("#deposit-form").off("submit");
      $("#deposit-form").submit();
    };
  </script>

{% endblock body %}
